<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D.G.P.M.B.-S.C.I.</title>
    <!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"-->
    <!--          integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">-->
    <link th:href="@{/assets/bootstrap-5.3.0-dist/css/bootstrap.min.css}" th:rel="stylesheet">
    <link th:href="@{/assets/fontawesome-free-5.15.4-web/css/all.min.css}" th:rel="stylesheet">
    <link th:href="@{/css/style.css}" th:rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-dark bg-dark fixed-navbar">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/request}">
            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="45" height="40" viewBox="0 0 256 256"
                 xml:space="preserve">
    <g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: none; fill-rule: nonzero; opacity: 1;"
       transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)">
        <path d="M 74.397 29.83 L 45.807 1.239 c -0.375 -0.375 -1.04 -0.375 -1.416 0 L 15.8 29.83 c -1.572 1.572 -1.572 4.13 0 5.703 s 4.131 1.571 5.702 0 l 0.979 -0.979 v 12.943 c 0 0.553 0.448 1.001 1.001 1.001 c 0.553 0 1.001 -0.448 1.001 -1.001 V 32.551 l 20.616 -20.616 l 20.616 20.616 v 14.945 c 0 0.553 0.448 1.001 1.001 1.001 s 1.001 -0.448 1.001 -1.001 V 34.553 l 0.979 0.979 c 0.762 0.762 1.774 1.181 2.851 1.181 c 1.077 0 2.09 -0.419 2.851 -1.181 c 0.762 -0.761 1.181 -1.774 1.181 -2.851 S 75.159 30.591 74.397 29.83 z M 72.981 34.116 c -0.766 0.766 -2.103 0.767 -2.87 0 L 45.807 9.812 c -0.196 -0.196 -0.452 -0.293 -0.708 -0.293 c -0.256 0 -0.512 0.098 -0.708 0.293 L 20.087 34.116 c -0.767 0.767 -2.103 0.766 -2.871 0 c -0.384 -0.384 -0.595 -0.893 -0.595 -1.436 c 0 -0.542 0.211 -1.052 0.594 -1.435 L 45.099 3.362 l 27.882 27.883 c 0.383 0.384 0.594 0.894 0.594 1.436 S 73.365 33.733 72.981 34.116 z"
              style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #FFFFFF; fill-rule: nonzero; opacity: 1;"
              transform=" matrix(1 0 0 1 0 0)" stroke-linecap="round"/>
        <path d="M 52.057 48.497 c -0.553 0 -1.001 -0.448 -1.001 -1.001 v -9.459 h -12.11 v 9.459 c 0 0.553 -0.448 1.001 -1.001 1.001 c -0.553 0 -1.001 -0.448 -1.001 -1.001 v -10.46 c 0 -0.553 0.448 -1.001 1.001 -1.001 h 14.112 c 0.553 0 1.001 0.448 1.001 1.001 v 10.46 C 53.058 48.049 52.61 48.497 52.057 48.497 z"
              style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #FFFFFF; fill-rule: nonzero; opacity: 1;"
              transform=" matrix(1 0 0 1 0 0)" stroke-linecap="round"/>
        <path d="M 89.497 59.748 c -3.888 -6.456 -10.369 -9.054 -16.135 -6.466 L 57.97 60.438 c -1.678 -2.659 -4.445 -5.578 -9.471 -4.722 l -14.065 2.553 c -2.204 0.191 -4.118 -0.711 -6.143 -1.655 c -2.143 -0.999 -4.362 -2.03 -7.012 -1.797 l -2.222 0.197 v -1.962 c 0 -1.845 -1.501 -3.346 -3.345 -3.346 H 3.345 C 1.501 49.706 0 51.207 0 53.052 v 32.646 c 0 1.845 1.501 3.346 3.345 3.346 h 12.366 c 1.844 0 3.345 -1.501 3.345 -3.346 v -0.339 l 5.79 -0.514 c 3.193 -0.281 6.411 0.912 9.522 2.069 c 2.822 1.049 5.73 2.13 8.668 2.13 c 0.335 0 0.671 -0.014 1.006 -0.044 c 6.322 -0.552 21.121 -9.824 38.255 -20.562 c 1.966 -1.232 3.952 -2.476 5.946 -3.72 C 89.946 63.655 90.509 61.425 89.497 59.748 z M 17.054 85.697 c 0 0.741 -0.602 1.343 -1.343 1.343 H 3.345 c -0.741 0 -1.343 -0.602 -1.343 -1.343 V 53.052 c 0 -0.741 0.602 -1.343 1.343 -1.343 h 12.366 c 0.741 0 1.343 0.602 1.343 1.343 v 2.14 v 30.344 V 85.697 z M 87.184 63.018 c -1.995 1.245 -3.983 2.49 -5.95 3.723 C 65.022 76.899 49.71 86.494 43.867 87.005 c -2.832 0.242 -5.73 -0.828 -8.801 -1.968 c -2.965 -1.103 -6.02 -2.238 -9.235 -2.238 c -0.385 0 -0.772 0.017 -1.162 0.051 l -5.613 0.499 V 57.024 l 2.399 -0.213 c 2.12 -0.189 3.998 0.69 5.99 1.618 c 2.173 1.012 4.421 2.056 7.249 1.823 l 14.153 -2.564 c 4.214 -0.719 6.34 1.886 7.86 4.536 l 0.457 0.797 l 0.001 0 l 0.857 1.494 c -7.289 4.119 -13.553 6.667 -19.124 7.78 c -0.543 0.109 -0.894 0.635 -0.786 1.178 c 0.095 0.476 0.513 0.805 0.981 0.805 c 0.065 0 0.131 -0.006 0.197 -0.02 c 6.008 -1.201 12.746 -3.982 20.6 -8.504 c 0.478 -0.275 0.643 -0.886 0.369 -1.365 l -1.271 -2.216 l 15.209 -7.071 c 4.786 -2.15 10.247 0.132 13.587 5.678 C 88.233 61.528 87.964 62.531 87.184 63.018 z"
              style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill: #FFFFFF; fill-rule: nonzero; opacity: 1;"
              transform=" matrix(1 0 0 1 0 0)" stroke-linecap="round"/>
    </g>
</svg>
            D.G.P.M.B. - SERVICIUL COMUNICATII SI INFORMATICA
        </a>
        <div class="row">
            <div class="col">
                <form class="d-inline-block mr-3" th:action="@{/request/admin}">
                    <button class="btn btn-outline-info my-2 my-sm-0" type="submit">Pagina admin</button>
                </form>
                <form class="d-inline-block" th:action="@{/request/add-request-form}">
                    <button class="btn btn-outline-info my-2 my-sm-0" type="submit">Adauga solicitare</button>
                </form>
            </div>
            <div class="col-auto">
                <div class="nav-item active">
                    <form th:action="@{/request/search-by-name}" method="get">
                        <div class="input-group">
                            <input class="form-control mr-sm-2" type="search" aria-label="Search" name="name"
                                   required placeholder="Nume solicitant" style="margin-right: 4px;">
                            <div class="input-group-append">
                                <button type="submit" class="btn btn-success" style="margin-left: 5px;">
                                    <span class="glyphicon glyphicon-search"></span> Cauta solicitare
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</nav>


<div class="content-wrap">

    <!--   Table start -->
    <div th:if="${#lists.isEmpty(requests)}">
        <h5>Nu exista inregistrari</h5>
    </div>

    <table th:if="${not #lists.isEmpty(requests)}" class="table table-hover text-center">
        <thead>
        <tr>
            <th>Tip solicitare</th>
            <th>Politist</th>
            <th>Structura</th>
            <th>Aprobat sef structura</th>
            <th>Aprobat structura securitate</th>
            <th>Aprobat sef SCI</th>
            <th>Status</th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="request: ${requests}">
            <!-- REQUEST TYPE -->
            <td>
                <span th:text="${request.getRequestTypeResponse.getRequestName()}"></span>
            </td>
            <!-- POLICEMAN DATA -->
            <td>
                 <span>
                     <em th:text="${request.getPolicemanResponse.rank.rankName}" style="font-style: italic;"></em>
                     <span th:text="${' ' + request.getPolicemanResponse.lastName + ' '
                                          + request.getPolicemanResponse.firstName
                     + (request.getPolicemanResponse.firstNameSecondary != null ? ' ' + request.getPolicemanResponse.firstNameSecondary : '')}"></span>
                </span>
            </td>
            <!-- POLICEMAN STRUCTURE -->
            <td>
                <span th:text="${request.getPolicemanResponse.getPoliceStructure.getStructureName}"></span>
            </td>

            <!-- POLICE STRUCTURE -->
            <td>
                <div>
                 <span th:if="${request.isApprovedByStructureChief}">
                     <i class="fas fa-check-circle text-success"></i> <!-- Green checkmark icon -->
                 </span>
                    <span th:unless="${request.isApprovedByStructureChief}">
                     <i class="fas fa-times-circle text-danger"></i> <!-- Red cross icon -->
                </span>
                </div>
                <div th:if="${!request.isApprovedByStructureChief && request.status.name() != 'Respinsa'}"
                     class="text-center">
                    <form id="decisionForm"
                          th:action="@{/request/structure-chief-decision/{requestId}(requestId=${request.id})}"
                          method="post">
                        <select class="form-select narrow-select" id="'decision-' + ${request.id}" name="decision"
                                onchange="onDecisionChange(${request.id})">
                            <option>AutorizeazÄƒ</option>
                            <option value="approve">APROBA</option>
                            <option value="reject">RESPINGE</option>
                        </select>
                        <input type="hidden" id="requestId" name="requestId" th:value="${request.id}">
                    </form>

                </div>
            </td>

            <!-- SECURITY STRUCTURE -->
            <td>
                <div>
                    <span th:if="${request.isApprovedBySecurityStructure}">
            <i class="fas fa-check-circle text-success"></i> <!-- Green checkmark icon -->
                    </span>
                    <span th:unless="${request.isApprovedBySecurityStructure}">
            <i class="fas fa-times-circle text-danger"></i> <!-- Red cross icon -->
        </span>
                </div>
                <div th:if="${!request.isApprovedBySecurityStructure && request.status.name() != 'Respinsa'}"
                     class="text-center">
                    <form id="decisionSecurityForm"
                          th:action="@{/request/structure-chief-decision/{requestId}(requestId=${request.id})}"
                          method="post">
                        <select class="form-select narrow-select" id="'securityDecision-' + ${request.id}"
                                name="decision" onchange="onDecisionChangeSecurity(${request.id})">
                            <option>AutorizeazÄƒ</option>
                            <option value="approve">APROBA</option>
                            <option value="reject">RESPINGE</option>
                        </select>
                        <input type="hidden" id="'requestSecurityId-' + ${request.id}" name="requestId"
                               th:value="${request.id}">
                    </form>
                </div>
            </td>


            <!-- IT STRUCTURE -->
            <td>
                <span th:if="${request.isApprovedByITChief}">
                    <i class="fas fa-check-circle text-success"></i> <!-- Green checkmark icon --></span>
                <span th:unless="${request.isApprovedByITChief}">
                     <i class="fas fa-times-circle text-danger"></i> <!-- Red cross icon --> </span>
                <div th:if="${!request.isApprovedByITChief && request.status.name() != 'Respinsa'}" class="text-center">
                    <form th:id="'decisionITForm-' + ${request.id}" method="post">
                        <select class="form-select narrow-select" id="itDecision-${request.id}" name="decision"
                                onchange="onDecisionChangeIT(this)">
                            <option>AutorizeazÄƒ</option>
                            <option value="approve">REPARTIZEAZA</option>
                            <option value="reject">RESPINGE</option>
                        </select>
                        <input type="hidden" th:id="'requestITId-' + ${request.id}" name="requestId"
                               th:value="${request.id}">
                    </form>

                </div>
            </td>

            <!-- STATUS -->
            <td>
                <span th:if="${request.status.name() == 'In_lucru'}"
                      style="font-style: italic; color:blue;">In lucru</span>
                <span th:if="${request.status.name() == 'Deschisa'}" style="font-style: italic; color:darkgoldenrod;">Deschisa</span>
                <span th:if="${request.status.name() == 'Respinsa'}"
                      style="font-style: italic; color:green;">Finalizata</span>
                <span th:if="${request.status.name() == 'Finalizata'}" style="font-style: italic; color:green;">Finalizata</span>
            </td>
            <!-- BUTTON -->
            <td>
                <form th:action="@{/request/find/{requestId}(requestId=${request.id})}">
                    <input type="hidden" name="requestId" th:value="${request.id}">
                    <button class="btn btn-outline-info my-2 my-sm-0" type="submit">Deschide</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>


<footer>
    <div class="container-fluid bg-light text-center">
        <div class="row">
            <div class="col-md-12">
                <p class="text-muted mb-0">Made with <i class="fas fa-heart text-danger"></i> for Police </p>
                <span id="currentDate" class="text-muted mb-0"></span>
                <div class="text-center">
                    <p class="text-muted mb-0 d-inline-block"><i class="fas fa-phone"></i>32105 </p>
                    <p class="text-muted mb-0 d-inline-block"><i class="fas fa-map-marker-alt"></i> Romania, Bucharest
                    </p>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- Modal pentru È™eful structurii -->
<div class="modal fade" id="rejectModal" tabindex="-1" role="dialog" aria-labelledby="structureRejectModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="structureRejectModalLabel">Motivul respingerii</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="text" id="observation" class="form-control" required>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">AnuleazÄƒ</button>
                <button type="button" class="btn btn-primary" onclick="submitRejectForm()">OK</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal pentru structura de securitate -->
<div class="modal fade" id="rejectModalForSecurity" tabindex="-1" role="dialog"
     aria-labelledby="securityRejectModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="securityRejectModalLabel">Motivul respingerii</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="text" id="securityObservation" class="form-control" placeholder="Motivul respingerii"
                       required>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">AnuleazÄƒ</button>
                <button type="button" class="btn btn-primary" onclick="submitRejectFormSecurity()">OK</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal respingere pentru structura IT -->
<div class="modal fade" id="rejectModalForIT" tabindex="-1" role="dialog" aria-labelledby="itRejectModalLabel"
     aria-hidden="true" data-request-id="">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="itRejectModalLabel">Motivul respingerii</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="text" id="itObservation" class="form-control" placeholder="Motivul respingerii"
                       required>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">AnuleazÄƒ</button>
                <button type="button" class="btn btn-primary" onclick="submitRejectFormIT(this)">OK</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal repartizare catre lucrator IT -->
<div class="modal fade" id="specialistAssign" tabindex="-1" role="dialog" aria-labelledby="specialistAssignModalLabel"
     aria-hidden="true" data-request-id="">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="specialistAssignModalLabel">Repartizare catre lucrator</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <select class="form-select" id="itSpecialistId" name="itSpecialistId" onchange="submitDecisionFormIT(this)">
                    <option value="">Selectati lucratorul</option>
                    <option th:each="specialist : ${specialists}" th:value="${specialist.id}"
                            th:text="${specialist.lastName + ' ' + specialist.firstName}"></option>
                </select>
            </div>
        </div>
    </div>
</div>


<script th:src="@{js/jquery-3.7.0.js}" type="text/javascript" th:attr="cache='no-cache'"></script>
<script th:src="@{/js/script.js}" type="text/javascript" th:attr="cache='no-cache'"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
</body>
</html>
